<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supabase ä»»åŠ¡ç®¡ç†</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* ä½¿ç”¨åŸ TaskMaster ä¸»é¢˜ */
    :root {
      --color-primary: #00999F;
      --color-primary-dark: #007f85;
      --color-accent: #FEEE30;
      --color-secondary-blue: #81D2E3;
      --color-bg-mint: #BCEDD8;
      --color-text-strong: #065758;
      --color-background: #f8f9fa;
      --color-surface: #ffffff;
      --color-border: #e9ecef;
      --color-success: #28a745;
      --color-danger: #e74c3c;
      --shadow-soft: 0 4px 15px rgba(6, 87, 88, 0.1);
      --border-radius: 8px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background-color: var(--color-background); color: var(--color-text-strong); height: 100vh; overflow: hidden; }
    /* ç™»å½•é¡µæ ·å¼ */
    #login-page { display: flex; justify-content: center; align-items: center; height: 100%; background-color: var(--color-background); }
    #login-card { background: var(--color-surface); padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow-soft); width: 360px; }
    #login-card h2 { margin-bottom: 1rem; text-align: center; }
    #login-card input { width: 100%; margin-bottom: 1rem; padding: 0.6rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); }
    #login-card button { width: 100%; margin-bottom: 0.5rem; padding: 0.6rem; border: none; border-radius: var(--border-radius); background-color: var(--color-primary); color: white; cursor: pointer; }
    #login-card button:hover { background-color: var(--color-primary-dark); }
    #login-msg { color: var(--color-danger); text-align: center; margin-top: 0.5rem; }
    /* ä¸»åº”ç”¨å¸ƒå±€ */
    .app-container { display: flex; height: 100%; }
    aside.sidebar { flex: 0 0 22rem; background: var(--color-surface); padding: 1.5rem; display: flex; flex-direction: column; gap: 1.2rem; box-shadow: var(--shadow-soft); overflow-y: auto; }
    .sidebar-section { background: var(--color-background); border-radius: var(--border-radius); padding: 1rem; }
    .sidebar-section h3 { font-size: 0.9rem; margin-bottom: 0.8rem; }
    main.main-content { flex: 1; display: flex; flex-direction: column; background: var(--color-surface); border-radius: var(--border-radius); box-shadow: var(--shadow-soft); overflow: hidden; }
    .tabs { display: flex; border-bottom: 1px solid var(--color-border); }
    .tab-button { flex: 1; padding: 0.8rem; background: transparent; border: none; font-weight: 500; cursor: pointer; }
    .tab-button.active { color: var(--color-primary); border-bottom: 3px solid var(--color-primary); }
    .tab-content { flex: 1; overflow-y: auto; padding: 1.5rem; }
    /* ä»»åŠ¡åˆ—è¡¨ */
    #add-task-form { display: grid; grid-template-columns: 2fr 1fr 1fr 1.5fr auto; gap: 1rem; margin-bottom: 1rem; }
    #add-task-form input, #add-task-form select { padding: 0.6rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); }
    #task-table { width: 100%; border-collapse: separate; border-spacing: 0 0.5rem; }
    #task-table thead th { padding: 0.6rem 1rem; text-align: left; font-size: 0.8rem; border-bottom: 1px solid var(--color-border); }
    #task-table tbody td { padding: 0.8rem 1rem; background: var(--color-surface); border-top: 1px solid var(--color-border); border-bottom: 1px solid var(--color-border); }
    /* å…¬å…±æŒ‰é’® */
    .btn { background: var(--color-border); color: var(--color-text-strong); padding: 0.6rem 1rem; border: none; border-radius: var(--border-radius); cursor: pointer; }
    .btn-primary { background: var(--color-primary); color: white; }
    .btn-primary:hover { background: var(--color-primary-dark); }
    /* å…¶ä»–æ ·å¼çœç•¥ï¼Œä¿æŒä¸ä½  TaskMaster-v1.0.html ä¸€è‡´ */
  </style>
</head>
<body>
  <!-- ç™»å½•é¡µ -->
  <div id="login-page">
    <div id="login-card">
      <h2>ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ</h2>
      <input id="email" type="email" placeholder="é‚®ç®±" />
      <input id="password" type="password" placeholder="å¯†ç " />
      <button id="btn-login">ç™»å½•</button>
      <button id="btn-signup">æ³¨å†Œ</button>
      <button id="btn-github">GitHub ç™»å½•</button>
      <p id="login-msg"></p>
    </div>
  </div>

  <!-- ä¸»åº”ç”¨ -->
  <div id="app" class="hidden">
    <div class="app-container">
      <aside class="sidebar">
        <div class="sidebar-section">
          <input id="search-box" placeholder="ğŸ” æœç´¢ä»»åŠ¡..." />
        </div>
        <div class="sidebar-section">
          <h3>æ’åºé€‰é¡¹</h3>
          <button id="sort-urgency" class="btn">æŒ‰é‡è¦ç¨‹åº¦</button>
          <button id="sort-status" class="btn">æŒ‰ä»»åŠ¡çŠ¶æ€</button>
          <button id="clear-filter" class="btn-primary">æ¸…é™¤ç­›é€‰</button>
        </div>
        <div class="sidebar-section">
          <h3>ä»»åŠ¡ç»Ÿè®¡</h3>
          <label>å¼€å§‹:</label><input id="stats-start-date" type="date" /><br>
          <label>ç»“æŸ:</label><input id="stats-end-date" type="date" />
          <div>æ€»æ•°: <span id="stat-total">0</span></div>
          <div>å®Œæˆ: <span id="stat-completed">0</span></div>
          <div>æœªå®Œæˆ: <span id="stat-pending">0</span></div>
        </div>
        <div class="sidebar-section">
          <h3>ç´§æ€¥ä»»åŠ¡ (è¿‘2å¤©)</h3>
          <ul id="urgent-tasks-list"></ul>
        </div>
        <div class="sidebar-section">
          <button id="backup-data" class="btn">å¤‡ä»½æ•°æ®</button>
        </div>
      </aside>
      <main class="main-content">
        <div class="tabs">
          <button data-tab="tasks" class="tab-button active">ä»»åŠ¡åˆ—è¡¨</button>
          <button data-tab="progress" class="tab-button">æ¯å‘¨è¿›å±•</button>
        </div>
        <div id="tab-tasks" class="tab-content">
          <!-- ä»»åŠ¡ç®¡ç†é€»è¾‘ä¸ TaskMaster-v1.0.html å®Œå…¨ä¸€è‡´ï¼Œæ­¤å¤„çœç•¥ï¼Œç›´æ¥å¼•å…¥åŸè„šæœ¬ -->
          <!-- ä½ å¯ä»¥å°† TaskMaster-v1.0.html çš„ <script>
window.addEventListener('DOMContentLoaded', () => {
  // åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
  const { createClient } = supabase;
  const supabaseClient = createClient(
    'https://oprqecajnzvzusjqqolk.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9wcnFlY2Fqbnp2enVzanFxb2xrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMTQzMzMsImV4cCI6MjA2OTU5MDMzM30.lY691Yw7u6ipUxXW6inYAnkv-ohJT96OWTAU-usMJOw'
  );

  // ç™»å½•/æ³¨å†ŒæŒ‰é’®
  const btnLogin = document.getElementById('btn-login');
  const btnSignup = document.getElementById('btn-signup');
  const btnGithub = document.getElementById('btn-github');
  const loginMsg = document.getElementById('login-msg');

  btnLogin.addEventListener('click', async () => {
    loginMsg.textContent = '';
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
    if (error) loginMsg.textContent = error.message;
    else location.reload();
  });

  btnSignup.addEventListener('click', async () => {
    loginMsg.textContent = '';
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const { error } = await supabaseClient.auth.signUp({ email, password });
    loginMsg.textContent = error ? error.message : 'æ³¨å†ŒæˆåŠŸï¼Œè¯·æ£€æŸ¥é‚®ç®±å¹¶éªŒè¯';
  });

  btnGithub.addEventListener('click', () => {
    supabaseClient.auth.signInWithOAuth({ provider: 'github' });
  });

  // ä¼šè¯æ£€æŸ¥
  async function checkSession() {
    const { data: { session } } = await supabaseClient.auth.getSession();
    if (session) {
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('app').classList.remove('hidden');
      // TODO: åœ¨æ­¤åˆå§‹åŒ– TaskMaster åŠŸèƒ½
    }
  }

  supabaseClient.auth.onAuthStateChange(() => {
    checkSession();
  });

  // é¦–æ¬¡æ‰§è¡Œ
  checkSession();
});
</script>
</body>
</html>
