<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supabase 任务管理</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* 使用原 TaskMaster 主题 */
    :root {
      --color-primary: #00999F;
      --color-primary-dark: #007f85;
      --color-accent: #FEEE30;
      --color-secondary-blue: #81D2E3;
      --color-bg-mint: #BCEDD8;
      --color-text-strong: #065758;
      --color-background: #f8f9fa;
      --color-surface: #ffffff;
      --color-border: #e9ecef;
      --color-success: #28a745;
      --color-danger: #e74c3c;
      --shadow-soft: 0 4px 15px rgba(6, 87, 88, 0.1);
      --border-radius: 8px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background-color: var(--color-background); color: var(--color-text-strong); height: 100vh; overflow: hidden; }
    /* 登录页样式 */
    #login-page { display: flex; justify-content: center; align-items: center; height: 100%; background-color: var(--color-background); }
    #login-card { background: var(--color-surface); padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow-soft); width: 360px; }
    #login-card h2 { margin-bottom: 1rem; text-align: center; }
    #login-card input { width: 100%; margin-bottom: 1rem; padding: 0.6rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); }
    #login-card button { width: 100%; margin-bottom: 0.5rem; padding: 0.6rem; border: none; border-radius: var(--border-radius); background-color: var(--color-primary); color: white; cursor: pointer; }
    #login-card button:hover { background-color: var(--color-primary-dark); }
    #login-msg { color: var(--color-danger); text-align: center; margin-top: 0.5rem; }
    /* 主应用布局 */
    .app-container { display: flex; height: 100%; }
    aside.sidebar { flex: 0 0 22rem; background: var(--color-surface); padding: 1.5rem; display: flex; flex-direction: column; gap: 1.2rem; box-shadow: var(--shadow-soft); overflow-y: auto; }
    .sidebar-section { background: var(--color-background); border-radius: var(--border-radius); padding: 1rem; }
    .sidebar-section h3 { font-size: 0.9rem; margin-bottom: 0.8rem; }
    main.main-content { flex: 1; display: flex; flex-direction: column; background: var(--color-surface); border-radius: var(--border-radius); box-shadow: var(--shadow-soft); overflow: hidden; }
    .tabs { display: flex; border-bottom: 1px solid var(--color-border); }
    .tab-button { flex: 1; padding: 0.8rem; background: transparent; border: none; font-weight: 500; cursor: pointer; }
    .tab-button.active { color: var(--color-primary); border-bottom: 3px solid var(--color-primary); }
    .tab-content { flex: 1; overflow-y: auto; padding: 1.5rem; }
    /* 任务列表 */
    #add-task-form { display: grid; grid-template-columns: 2fr 1fr 1fr 1.5fr auto; gap: 1rem; margin-bottom: 1rem; }
    #add-task-form input, #add-task-form select { padding: 0.6rem; border: 1px solid var(--color-border); border-radius: var(--border-radius); }
    #task-table { width: 100%; border-collapse: separate; border-spacing: 0 0.5rem; }
    #task-table thead th { padding: 0.6rem 1rem; text-align: left; font-size: 0.8rem; border-bottom: 1px solid var(--color-border); }
    #task-table tbody td { padding: 0.8rem 1rem; background: var(--color-surface); border-top: 1px solid var(--color-border); border-bottom: 1px solid var(--color-border); }
    /* 公共按钮 */
    .btn { background: var(--color-border); color: var(--color-text-strong); padding: 0.6rem 1rem; border: none; border-radius: var(--border-radius); cursor: pointer; }
    .btn-primary { background: var(--color-primary); color: white; }
    .btn-primary:hover { background: var(--color-primary-dark); }
    /* 其他样式省略，保持与你 TaskMaster-v1.0.html 一致 */
  </style>
</head>
<body>
  <!-- 登录页 -->
  <div id="login-page">
    <div id="login-card">
      <h2>任务管理系统</h2>
      <input id="email" type="email" placeholder="邮箱" />
      <input id="password" type="password" placeholder="密码" />
      <button id="btn-login">登录</button>
      <button id="btn-signup">注册</button>
      <button id="btn-github">GitHub 登录</button>
      <p id="login-msg"></p>
    </div>
  </div>

  <!-- 主应用 -->
  <div id="app" class="hidden">
    <div class="app-container">
      <aside class="sidebar">
        <div class="sidebar-section">
          <input id="search-box" placeholder="🔍 搜索任务..." />
        </div>
        <div class="sidebar-section">
          <h3>排序选项</h3>
          <button id="sort-urgency" class="btn">按重要程度</button>
          <button id="sort-status" class="btn">按任务状态</button>
          <button id="clear-filter" class="btn-primary">清除筛选</button>
        </div>
        <div class="sidebar-section">
          <h3>任务统计</h3>
          <label>开始:</label><input id="stats-start-date" type="date" /><br>
          <label>结束:</label><input id="stats-end-date" type="date" />
          <div>总数: <span id="stat-total">0</span></div>
          <div>完成: <span id="stat-completed">0</span></div>
          <div>未完成: <span id="stat-pending">0</span></div>
        </div>
        <div class="sidebar-section">
          <h3>紧急任务 (近2天)</h3>
          <ul id="urgent-tasks-list"></ul>
        </div>
        <div class="sidebar-section">
          <button id="backup-data" class="btn">备份数据</button>
        </div>
      </aside>
      <main class="main-content">
        <div class="tabs">
          <button data-tab="tasks" class="tab-button active">任务列表</button>
          <button data-tab="progress" class="tab-button">每周进展</button>
        </div>
        <div id="tab-tasks" class="tab-content">
          <!-- 任务管理逻辑与 TaskMaster-v1.0.html 完全一致，此处省略，直接引入原脚本 -->
          <!-- 你可以将 TaskMaster-v1.0.html 的 <script>
window.addEventListener('DOMContentLoaded', () => {
  // 初始化 Supabase 客户端
  const { createClient } = supabase;
  const supabaseClient = createClient(
    'https://oprqecajnzvzusjqqolk.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9wcnFlY2Fqbnp2enVzanFxb2xrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMTQzMzMsImV4cCI6MjA2OTU5MDMzM30.lY691Yw7u6ipUxXW6inYAnkv-ohJT96OWTAU-usMJOw'
  );

  // 登录/注册按钮
  const btnLogin = document.getElementById('btn-login');
  const btnSignup = document.getElementById('btn-signup');
  const btnGithub = document.getElementById('btn-github');
  const loginMsg = document.getElementById('login-msg');

  btnLogin.addEventListener('click', async () => {
    loginMsg.textContent = '';
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
    if (error) loginMsg.textContent = error.message;
    else location.reload();
  });

  btnSignup.addEventListener('click', async () => {
    loginMsg.textContent = '';
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const { error } = await supabaseClient.auth.signUp({ email, password });
    loginMsg.textContent = error ? error.message : '注册成功，请检查邮箱并验证';
  });

  btnGithub.addEventListener('click', () => {
    supabaseClient.auth.signInWithOAuth({ provider: 'github' });
  });

  // 会话检查
  async function checkSession() {
    const { data: { session } } = await supabaseClient.auth.getSession();
    if (session) {
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('app').classList.remove('hidden');
      // TODO: 在此初始化 TaskMaster 功能
    }
  }

  supabaseClient.auth.onAuthStateChange(() => {
    checkSession();
  });

  // 首次执行
  checkSession();
});
</script>
</body>
</html>
